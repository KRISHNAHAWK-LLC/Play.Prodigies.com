window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};})();function BufferLoader(context,urlList,callback){this.debug_buffer_loader=true;this.context=context;this.urlList=urlList;this.onload=callback;this.bufferList=new Array();this.loadCount=0;}
BufferLoader.prototype.load=function(){for(var i=0;i<this.urlList.length;++i){this.loadBuffer(this.urlList[i],i);}};BufferLoader.prototype.loadBuffer=function(url,index){var request=new XMLHttpRequest();request.open("GET",url,true);request.responseType="arraybuffer";var loader=this;request.onload=function(){loader.context.decodeAudioData(request.response,function(buffer){if(!buffer){console.log('ERROR error decoding file data: '+url);return;}
loader.bufferList[index]=buffer;if(++loader.loadCount==loader.urlList.length){loader.onload(loader.bufferList);}},function(error){});};request.onerror=function(){console.log('ERROR BufferLoader: XHR error');};request.send();};